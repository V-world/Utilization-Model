<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë¸Œì´ì›”ë“œ WMTS Ã— ì§€ë¦¬ì› WMTS ë¹„êµ ì§€ë„</title>

  <!-- OpenLayers -->
  <script src="https://openlayers.org/en/v6.15.1/build/ol.js"></script>
  <link rel="stylesheet" href="https://openlayers.org/en/v6.15.1/css/ol.css" type="text/css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.4.4/proj4.js"></script>
  <script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>

  <style>
    /* ===== ê¸°ë³¸ ë ˆì´ì•„ì›ƒ / ì „ì²´ ìŠ¤íƒ€ì¼ ===== */
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      background: #f3f5f3;
      color: #2c3e2f;
    }

    .container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      background: linear-gradient(135deg, #0d4f3b, #146a4c);
      color: #fff;
      padding: 12px 20px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      position: relative;
      z-index: 10;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo {
      font-size: 26px;
    }

    header h1 {
      font-size: 18px;
      margin: 0;
      font-weight: 700;
      white-space: nowrap;
    }

    .header-subtitle {
      font-size: 12px;
      opacity: 0.9;
      margin-left: 4px;
      white-space: nowrap;
    }

    .header-spacer {
      flex: 1;
    }

    .header-info {
      font-size: 11px;
      opacity: 0.85;
      white-space: nowrap;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      max-width: 1200px;
      width: 100%;
      margin: 12px auto 16px;
      padding: 0 12px;
      gap: 10px;
    }

    .map-wrapper {
      display: flex;
      gap: 10px;
      flex: 1;
      min-height: 480px;
    }

    .map-panel {
      flex: 1;
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .map-title {
      padding: 8px 12px;
      font-size: 13px;
      font-weight: 600;
      background: #0d4f3b;
      color: #ecf9f2;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
	  font-size: 18px;        /* ğŸ”¥ ê¸€ì”¨ í¬ê²Œ */
	  font-weight: 600;       /* êµµê²Œ */
	  text-align: center;
    }

    #map,
    #map2 {
      flex: 1;
    }

    .bottom-panel {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      padding: 8px 10px;
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
    }

    .bottom-text {
      color: #344b3b;
    }

    /* ê·€ì—¬ìš´ í† ê¸€ ìŠ¤ìœ„ì¹˜ ìŠ¤íƒ€ì¼ */
    .switch {
      position: relative;
      display: inline-block;
      width: 46px;
      height: 22px;
      vertical-align: middle;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #cfd8d3;
      transition: .3s;
      border-radius: 34px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .3s;
      border-radius: 50%;
      box-shadow: 0 1px 3px rgba(0,0,0,0.3);
    }

    input:checked + .slider {
      background-color: #138a58;
    }

    input:checked + .slider:before {
      transform: translateX(22px);
    }

    .switch-label {
      margin-left: 8px;
      font-size: 12px;
    }

    footer {
      text-align: center;
      font-size: 11px;
      color: #7d8c7f;
      padding: 8px 0 12px;
    }

    /* ===== OpenLayers ì»¤ìŠ¤í…€ ì»¨íŠ¸ë¡¤ ìŠ¤íƒ€ì¼ ===== */
    /* ê³µí†µ ì»¨íŠ¸ë¡¤ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
    .ol-mycontrol,
    .ol-mycontrol2 {
      position: absolute;
      top: 10px;
      left: 70px; /* ì¤Œ ë²„íŠ¼ê³¼ ê²¹ì¹˜ì§€ ì•Šê²Œ ì˜¤ë¥¸ìª½ */
      
      display: flex;
      flex-direction: row; /* ğŸ”¥ ê°€ë¡œ ë°°ì¹˜ */
      gap: 6px;

      background: rgba(20, 60, 40, 0.8);  /* ì§™ì€ ë…¹ìƒ‰ í†¤ */
      padding: 6px 8px;
      border-radius: 12px;
      backdrop-filter: blur(3px);
      box-shadow: 0 3px 8px rgba(0,0,0,0.25);
      z-index: 1000;
    }

    /* ì˜¤ë¥¸ìª½ ì§€ë„ìš©ë„ ë™ì¼ UI ìœ ì§€ */
    .ol-mycontrol2 {
     left: 70px;
    }

    /* ë²„íŠ¼ ìì²´ ìŠ¤íƒ€ì¼ */
    .ol-mycontrol button,
    .ol-mycontrol2 button {
      width: 34px;
      height: 34px;
      font-size: 14px;
      font-weight: bold;

      border: none;
      border-radius: 8px;
      cursor: pointer;

      background: #1f7d52;  /* ì§„í•œ ë…¹ìƒ‰ ë²„íŠ¼ */
      color: white;
      transition: 0.2s;
    }

    /* hover íš¨ê³¼ */
    .ol-mycontrol button:hover,
    .ol-mycontrol2 button:hover {
      background: #29a06a;
      transform: translateY(-2px);
    }

    /* on ë²„íŠ¼ í‘œì‹œ */
    .ol-mycontrol button.on,
    .ol-mycontrol2 button.on {
      background: #ffcc00;
      color: #000;
    }

    /* ì¤ŒìŠ¬ë¼ì´ë” ìƒ‰ë„ ë…¹ìƒ‰ ê³„ì—´ë¡œ */
    .ol-zoomslider {
      top: 70px;
      left: 8px;
      background: rgba(13, 79, 59, 0.1);
      border-radius: 6px;
    }
    .ol-zoomslider button {
      background: #0d4f3b;
    }

    /* ì‘ì€ í™”ë©´ ëŒ€ì‘ */
    @media (max-width: 900px) {
      .map-wrapper {
        flex-direction: column;
      }
    }

    #map2 {
      position: relative; /* ìì‹ ì˜¤ë²„ë ˆì´ ê¸°ì¤€ì  */
    }

    .map-notice {
      position: absolute;
      inset: 0; /* top:0; right:0; bottom:0; left:0; */
      display: none; /* ê¸°ë³¸ì€ ìˆ¨ê¹€ */
      align-items: center;
      justify-content: center;
      text-align: center;

      padding: 16px;
      background: rgba(0, 0, 0, 0.55);
      color: #f9f9f9;
      font-size: 13px;
      line-height: 1.5;
      z-index: 2000;
    }

  </style>
</head>
<body>
<div class="container">
  <header>
    <div class="header-content">
      <div class="logo">ğŸ—ºï¸</div>
      <h1>ë¸Œì´ì›”ë“œ Ã— ì§€ë¦¬ì› WMTS ì˜ìƒì§€ë„ ë¹„êµ</h1>
      <div class="header-subtitle">ë¸Œì´ì›”ë“œ ì¢Œí‘œì²´ê³„ ê¸°ë°˜ íƒ€ì¼ ì •í•© í™•ì¸</div>
      <div class="header-spacer"></div>
      <div class="header-info">ë°ì´í„° ì¶œì²˜ : êµ­í† ì§€ë¦¬ì •ë³´ì›, ë¸Œì´ì›”ë“œ</div>
    </div>
  </header>

  <main>
    <div class="map-wrapper">
      <div class="map-panel">
        <div class="map-title">ë¸Œì´ì›”ë“œ</div>
        <div id="map"></div>
      </div>
      <div class="map-panel">
        <div class="map-title">êµ­í† ì§€ë¦¬ì •ë³´ì›</div>
        <div id="map2">
          <div id="ngii-notice" class="map-notice">
            HTTPS í˜¸ì¶œë¡œ ì¸í•´ ë¡œì»¬ì—ì„œ ì†ŒìŠ¤ë¥¼ ë‹¤ìš´ë°›ì•„ ì‚¬ìš©í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
          </div>
        </div>
      </div>
    </div>

    <div class="bottom-panel">
      <div class="bottom-text">
        ë¸Œì´ì›”ë“œ ì¢Œí‘œ ê¸°ë°˜ ë¸Œì´ì›”ë“œÂ·ì§€ë¦¬ì› íƒ€ì¼ ë¹„êµ
      </div>
      <div>
        <label class="switch">
          <input type="checkbox" id="WMS_LAYER">
          <span class="slider"></span>
        </label>
        <span class="switch-label">ì£¼ìš”ìƒê¶Œ WMS ë ˆì´ì–´ í‘œì‹œ</span>
      </div>
    </div>
  </main>

  <footer>
    Â© ë¸Œì´ì›”ë“œ / êµ­í† ì§€ë¦¬ì •ë³´ì› WMTS í…ŒìŠ¤íŠ¸ ë·°
  </footer>
</div>

<script type="text/javascript">
  const isHttps = location.protocol === "https:";

  //ë°”ë¡œì´ë§µ ì„¤ì •
  var epsg5179 = "+proj=tmerc +lat_0=38 +lon_0=127.5 +k=0.9996 +x_0=1000000 +y_0=2000000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs";
  proj4.defs("EPSG:5179", epsg5179);
  ol.proj.proj4.register(proj4)
  var view_projection = ol.proj.get("EPSG:5179");
  var view_extent = [743623.1161898939, 1456333.7988633565, 1394868.4484408265, 2070228.7850445202];
  var oo78 = [-200000, -28024123.62, 31824123.62, 4000000];

  ol.proj.get("EPSG:5179").setExtent(oo78)

  var key = "48B39DEAF1939913FAD957A5BA699048";

  var geotileGrid = new ol.tilegrid.WMTS({
    origin : [ -200000.0, 4000000.0 ],
    resolutions: [2088.96, 1044.48, 522.24, 261.12, 130.56, 65.28, 32.64, 16.32, 8.16, 4.08, 2.04, 1.02, 0.51, 0.255],
    matrixIds : [ 'L05', 'L06', 'L07', 'L08', 'L09', 'L10', 'L11',
      'L12', 'L13', 'L14', 'L15', 'L16', 'L17', 'L18' ]
  });

  var geotileGrid2 = new ol.tilegrid.WMTS({
    origin : [ -200000.0, 4000000.0 ],
    resolutions: [2088.96, 1044.48, 522.24, 261.12, 130.56, 65.28, 32.64, 16.32, 8.16, 4.08, 2.04, 1.02, 0.51, 0.255],
    matrixIds : [ '5','6', '7', '8', '9', '10', '11',
      '12', '13', '14', '15', '16', '17', '18' ]
  });

  var source = new ol.source.WMTS({
    layer: "korean_map",
    url : "http://map.ngii.go.kr/openapi/Gettile.do?apikey=" + key,
    service : 'WMTS',
    format : 'image/png',
    matrixSet : 'korean',
    tileGrid : geotileGrid,
    projection: 'EPSG:5179',
  });

  var source2 = new ol.source.WMTS({
    layer: "AIRPHOTO",
    url : "http://210.117.198.120:8081/o2map/services",
    service : 'WMTS',
    matrixSet : 'NGIS_AIR',
    style:"_null",
    format:"image/jpg",
    projection: 'EPSG:5179',
    tileGrid : geotileGrid2,
  });

  var source12 = new ol.source.WMTS({
    //layer : ["AIRPHOTO", "AIRPHOTO_2011", "AIRPHOTO_2012", "AIRPHOTO_2013", "AIRPHOTO_2014", "AIRPHOTO_2015", "AIRPHOTO_2016", "AIRPHOTO_2017", "AIRPHOTO_2018", "AIRPHOTO_2019"],
    layer: "AIRPHOTO_2012",
    url : "http://210.117.198.120:8081/o2map/services",
    service : 'WMTS',
    matrixSet : 'NGIS_AIR',
    style:"_null",
    format:"image/jpg",
    projection: 'EPSG:5179',
    tileGrid : geotileGrid2,
  });

  var attr = '&copy; <a href="http://dev.vworld.kr">vworld</a>';

  var sourcev = new ol.source.XYZ({
    url: 'https://api.vworld.kr/req/wmts/1.0.0/CEB52025-E065-364C-9DBA-44880E3B02B8/Satellite/{z}/{y}/{x}.jpeg',
    attributions : attr
  });

  var view = new ol.View({
    projection : "EPSG:3857",
    center:  ol.proj.transform([127.100616,37.402142], 'EPSG:4326', 'EPSG:3857'),
    zoom: 0
  });

  var baro_map = new ol.layer.Tile({
    source : source,
    id : 'baro_map',
    name : "mapLayer"
  });

  var debug = new ol.layer.Tile({
    name : "debug",
    source: new ol.source.TileDebug()
  });

  var baro_debug = new ol.layer.Tile({
    name : "debug",
    source: new ol.source.TileDebug()
  });

  var VworldHybrid = new ol.source.XYZ({
    url: 'https://api.vworld.kr/req/wmts/1.0.0/CEB52025-E065-364C-9DBA-44880E3B02B8/Hybrid/{z}/{y}/{x}.png'
  });

  var VworldSatellite = new ol.source.XYZ({
    url: 'https://api.vworld.kr/req/wmts/1.0.0/CEB52025-E065-364C-9DBA-44880E3B02B8/Satellite/{z}/{y}/{x}.jpeg',
    attributions : attr
  });

  var VworldBase = new ol.source.XYZ({
    url: 'https://api.vworld.kr/req/wmts/1.0.0/CEB52025-E065-364C-9DBA-44880E3B02B8/Base/{z}/{y}/{x}.png',
    attributions : attr
  });

  var VworldGray =  new ol.source.XYZ({
    url: 'https://api.vworld.kr/req/wmts/1.0.0/CEB52025-E065-364C-9DBA-44880E3B02B8/gray/{z}/{y}/{x}.png',
    attributions : attr
  });

  var VworldMidnight =  new ol.source.XYZ({
    url: 'https://api.vworld.kr/req/wmts/1.0.0/CEB52025-E065-364C-9DBA-44880E3B02B8/midnight/{z}/{y}/{x}.png',
    attributions : attr
  });

  // ì»¨íŠ¸ë¡¤ ë²„íŠ¼ë“¤
  var element = document.createElement('div');
  element.className = 'rotate-north ol-unselectable ol-control ol-mycontrol';

  var base_button = document.createElement('button');
  base_button.innerHTML = 'B';
  var gray_button = document.createElement('button');
  gray_button.innerHTML = 'G';
  var midnight_button = document.createElement('button');
  midnight_button.innerHTML = 'M';
  var hybrid_button = document.createElement('button');
  hybrid_button.innerHTML = 'H';
  hybrid_button.className='on';
  var sate_button = document.createElement('button');
  sate_button.innerHTML = 'S';
  var debug_button = document.createElement('button');
  debug_button.innerHTML = 'D';
  debug_button.className='on';

  base_button.onclick=function(){
    map.getLayers().forEach(function(layer){
      if(layer.get("name")=="vworld"){
        layer.setSource(VworldBase)
      }
    })
  }
  gray_button.onclick=function(){
    map.getLayers().forEach(function(layer){
      if(layer.get("name")=="vworld"){
        layer.setSource(VworldGray)
      }
    })
  }
  midnight_button.onclick=function(){
    map.getLayers().forEach(function(layer){
      if(layer.get("name")=="vworld"){
        layer.setSource(VworldMidnight)
      }
    })
  }
  sate_button.onclick=function(){
    map.getLayers().forEach(function(layer){
      if(layer.get("name")=="vworld"){
        layer.setSource(VworldSatellite)
      }
    })
  }
  hybrid_button.onclick=function(){
    var _this = this;
    map.getLayers().forEach(function(layer){
      if(layer.get("name")=="hybrid"){
        if(_this.className == "on"){
          layer.setSource(null)
          _this.className ="";
        }else{
          _this.className ="on";
          layer.setSource(VworldHybrid)
        }
      }
    })
  }

  debug_button.onclick=function(){
    var _this = this;
    map.getLayers().forEach(function(layer){
      if(layer.get("name")=="debug"){
        if(_this.className == "on"){
          _this.className ="";
          layer.setVisible(false)
        }else{
          _this.className ="on";
          layer.setVisible(true)
        }
      }
    })
  }

  element.appendChild(base_button);
  element.appendChild(gray_button);
  element.appendChild(midnight_button);
  element.appendChild(sate_button);
  element.appendChild(hybrid_button);
  element.appendChild(debug_button);

  var layerControl = new ol.control.Control({element: element});

  let olView = new ol.View({
    center: ol.proj.transform([127.100616,37.402142], 'EPSG:4326', 'EPSG:900913'),
    zoom: 7,
    minZoom : 0,
    maxZoom : 19
  })

  map = new ol.Map({
    controls: ol.control.defaults().extend([
      layerControl,
      new ol.control.OverviewMap({
        layers:[new ol.layer.Tile({
          source: VworldBase,
          name:"vworld"
        })],
      }),
      new ol.control.ZoomSlider()
    ]),
    layers: [
      new ol.layer.Tile({
        source: new ol.source.OSM()
      }),
      new ol.layer.Tile({
        source: VworldSatellite,
        name:"vworld"
      }),
      new ol.layer.Tile({
        source: VworldHybrid,
        name:"hybrid"
      }),
      debug
    ],
    target: 'map',
    view: olView
  });

  var baro_button = document.createElement('button');
  baro_button.innerHTML = 'B';
  var air_button = document.createElement('button');
  air_button.innerHTML = 'mg';
  var air12_button = document.createElement('button');
  air12_button.innerHTML = '12';
  var v_button = document.createElement('button');
  v_button.innerHTML = 'vw';

  var element2 = document.createElement('div');
  element2.className = 'rotate-north ol-unselectable ol-control ol-mycontrol2';

  element2.appendChild(baro_button);
  element2.appendChild(air_button);
  element2.appendChild(air12_button);
  element2.appendChild(v_button);

  var layerControl2 = new ol.control.Control({element: element2});

  let map2 = new ol.Map({
    controls: ol.control.defaults().extend([
      layerControl2,
      new ol.control.ZoomSlider()
    ]),
    layers: [baro_map,baro_debug],
    target: 'map2',
    view: olView
  });

  const noticeEl = document.getElementById("ngii-notice");

  // ê³µí†µ: ì•ˆë‚´ ìˆ¨ê¸°ëŠ” í•¨ìˆ˜
  function hideNotice() {
    if (noticeEl) noticeEl.style.display = "none";
  }

  baro_button.onclick = function(){
    hideNotice();
    baro_map.setSource(source);
  };

  air_button.onclick = function(){
    if (isHttps) {
      if (noticeEl) noticeEl.style.display = "flex";
    } else {
      hideNotice();
      baro_map.setSource(source2);  // ì§€ë¦¬ì› AIRPHOTO
    }
  };

  air12_button.onclick = function(){
    if (isHttps) {
      if (noticeEl) noticeEl.style.display = "flex";
    } else {
      hideNotice();
      baro_map.setSource(source12); // ì§€ë¦¬ì› AIRPHOTO_2012
    }
  };

  v_button.onclick = function(){
    hideNotice();
    baro_map.setSource(sourcev);
  };


  let wms_title = 'ì£¼ìš”ìƒê¶Œ';
  let wms_val = 'lt_c_dgmainbiz';

  let wms_tile = new ol.layer.Tile({
    name : "WMS_LAYER",
    source : new ol.source.TileWMS({
      url : "http://api.vworld.kr/req/wms?",
      params : {
        LAYERS : wms_val,
        STYLES : wms_val,
        CRS : "EPSG:900913",
        apikey : "CEB52025-E065-364C-9DBA-44880E3B02B8",
        DOMAIN : "http://localhost:8080",
        title : wms_title,
        FORMAT : "image/png",
        domain : "http://localhost"
      }
    })
  });

  $('#WMS_LAYER').on("click",function(){
    if($(this).is(":checked")){
      map.addLayer(wms_tile);
      map2.addLayer(wms_tile);
    }else{
      map.removeLayer(wms_tile);
      map2.removeLayer(wms_tile);
    }
  });
</script>
</body>
</html>
